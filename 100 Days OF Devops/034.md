# Day 34: Git Hook

The Nautilus application development team is working on a Git repository located at `/opt/cluster.git`, which has been cloned under the directory `/usr/src/kodekloudrepos` on the Storage server in Stratos DC. The team wants to set up a hook on this repository. Below are the details:

## Task Details

- Merge the feature branch into the master branch.
- Before pushing your changes, complete the following step:
  
### Create a Post-Update Hook

Create a `post-update` hook in this Git repository so that whenever any changes are pushed to the `master` branch, it automatically creates a release tag with the name `release-YYYY-MM-DD`, where `YYYY-MM-DD` is the current date.

**Example:**
- If today is June 20, 2023, then the release tag should be `release-2023-06-20`.

Make sure to test the hook at least once and create a release tag for today's release.


# Solution



## Problem Summary
- Repository: `/opt/cluster.git` (bare repository)
- Working copy: `/usr/src/kodekloudrepos/cluster`
- Requirement:
  - Merge `feature` branch into `master`
  - Create a `post-update` hook
  - On every push to `master`, automatically create a tag  
    `release-YYYY-MM-DD` (current date)
  - Test the hook at least once

--- 

## Step 1: Merge `feature` into `master`

```bash
cd /usr/src/kodekloudrepos/cluster

git checkout master
git pull origin master
git checkout feature
git pull origin feature

git checkout master
git merge feature
```

## Step 2: Configure Git User Identity (Required)

```
git config --global user.name "natasha"
git config --global user.email "natasha@stratos.local"
```

## Step 3: Create the post-update Hook

Hooks must be created in the bare repository.

```
cd /opt/cluster.git/hooks
vi post-update
```

Add the following content:

```
#!/bin/bash

for ref in "$@"
do
  if [ "$ref" = "refs/heads/master" ]; then
    TAG="release-$(date +%F)"
    git tag "$TAG"
  fi
done
```

Make the hook executable:
```
chmod +x post-update
```

## Step 4: Trigger the Hook (Test)

Create a small change so that master is updated:

```
cd /usr/src/kodekloudrepos/cluster

echo "release trigger" >> trigger.txt
git add trigger.txt
git commit -m "Trigger post-update hook"
git push origin master
```

## Step 5: Verify the Tag

```
cd /opt/cluster.git
git tag
```

Expected Output

```
release-YYYY-MM-DD
```

(Example: release-2026-02-10)